"use strict";function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function n(s,r){try{var o=t[s](r),a=o.value}catch(e){return void i(e)}if(!o.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}("next")})}}function Ajaxinate(e){var t=e||{};this.settings=Object.assign({method:"scroll",container:"#AjaxinateContainer",pagination:"#AjaxinatePagination",productCard:".product-card",offset:0,loadingText:"Loading",callback:null,saveHistory:!1,loader:!1},t),this.addScrollListeners=this.addScrollListeners.bind(this),this.addClickListener=this.addClickListener.bind(this),this.checkIfPaginationInView=this.checkIfPaginationInView.bind(this),this.preventMultipleClicks=this.preventMultipleClicks.bind(this),this.removeClickListener=this.removeClickListener.bind(this),this.removeScrollListener=this.removeScrollListener.bind(this),this.removePaginationElement=this.removePaginationElement.bind(this),this.loadPreviousContent=this.loadPreviousContent.bind(this),this.destroy=this.destroy.bind(this),this.containerElement=document.querySelector(this.settings.container),this.paginationElement=document.querySelector(this.settings.pagination),this.productCardElement=document.querySelectorAll(this.settings.productCard),this.initialize()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Ajaxinate=Ajaxinate,Ajaxinate.prototype.initialize=function(){this.containerElement&&({click:this.addClickListener,scroll:this.addScrollListeners}[this.settings.method](),this.settings.saveHistory&&this.addClickListenerProductCard(),this.settings.saveHistory&&document.addEventListener("load",this.loadPreviousContent))},Ajaxinate.prototype.addScrollListeners=function(){this.paginationElement&&(document.addEventListener("scroll",this.checkIfPaginationInView),window.addEventListener("resize",this.checkIfPaginationInView),window.addEventListener("orientationchange",this.checkIfPaginationInView))},Ajaxinate.prototype.addClickListener=function(){this.paginationElement&&(this.nextPageLinkElement=this.paginationElement.querySelector("a"),this.clickActive=!0,void 0!==this.nextPageLinkElement&&null!==this.nextPageLinkElement&&this.nextPageLinkElement.addEventListener("click",this.preventMultipleClicks))},Ajaxinate.prototype.preventMultipleClicks=function(e){e.preventDefault(),this.clickActive&&(this.nextPageLinkElement.innerText=this.settings.loadingText,this.nextPageUrl=this.nextPageLinkElement.href,this.clickActive=!1,this.loadMore())},Ajaxinate.prototype.checkIfPaginationInView=function(){var e=this.paginationElement.getBoundingClientRect().top-this.settings.offset,t=this.paginationElement.getBoundingClientRect().bottom+this.settings.offset;e<=window.innerHeight&&t>=0&&(this.nextPageLinkElement=this.paginationElement.querySelector("a"),this.removeScrollListener(),this.nextPageLinkElement&&(this.nextPageLinkElement.innerText=this.settings.loadingText,this.nextPageUrl=this.nextPageLinkElement.href,this.loadMore()))},Ajaxinate.prototype.addClickListenerProductCard=function(){if(this.productCardElement&&!this.containerElement.hasClickListener){var e=function(e){var t=e.target.closest(".product-card");t&&this.contains(t)&&(sessionStorage.setItem("scrollPosition",window.scrollY),console.log("product card clicked"))};this.containerElement.addEventListener("click",e),this.containerElement.addEventListener("touchstart",e),this.containerElement.hasClickListener=!0}},Ajaxinate.prototype.addLoader=function(){var e=document.createElement("div");e.className="loader-container";var t=document.createElement("div");t.className="loader",e.appendChild(t),this.containerElement.appendChild(e)},Ajaxinate.prototype.removeLoader=function(){this.containerElement.removeChild(document.querySelector(".loader-container"))},Ajaxinate.prototype.loadPreviousContent=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,i,n,s,r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.location.search,i=new URLSearchParams(t),null!==(n=i.get("page"))){e.next=6;break}return this.scrollToSavedPosition(),e.abrupt("return");case 6:this.settings.loader&&this.addLoader(),s=regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.request=new XMLHttpRequest,i=window.location.origin+window.location.pathname+"?page="+t,e.next=4,new Promise(function(e,t){o.request.onreadystatechange=function(){if(4===this.request.readyState&&this.request.responseXML&&200===this.request.status){var t=this.request.responseXML.querySelectorAll(this.settings.container)[0],i=this.request.responseXML.querySelectorAll(this.settings.pagination)[0];this.containerElement.insertAdjacentHTML("afterbegin",t.innerHTML),void 0===i||this.initialize(),e()}}.bind(o),o.request.open("GET",i),o.request.responseType="document",o.request.send()});case 4:case"end":return e.stop()}},e,o)}),r=n-1;case 9:if(!(r>=1)){e.next=14;break}return e.delegateYield(s(r),"t0",11);case 11:r--,e.next=9;break;case 14:this.scrollToSavedPosition(),this.settings.loader&&this.removeLoader();case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),Ajaxinate.prototype.scrollToSavedPosition=function(){var e=sessionStorage.getItem("scrollPosition");e&&(window.scrollTo({top:e,behavior:"smooth"}),sessionStorage.removeItem("scrollPosition"))},Ajaxinate.prototype.loadMore=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){if(this.request.responseXML&&4!==!this.request.readyState&&200!==!this.request.status){var e=this.request.responseXML.querySelectorAll(this.settings.container)[0],t=this.request.responseXML.querySelectorAll(this.settings.pagination)[0];this.containerElement.insertAdjacentHTML("beforeend",e.innerHTML),void 0===t?(this.settings.saveHistory&&window.history.pushState({path:this.nextPageUrl},"",this.nextPageUrl),this.removePaginationElement()):(this.paginationElement.innerHTML=t.innerHTML,this.settings.saveHistory&&window.history.pushState({path:this.nextPageUrl},"",this.nextPageUrl),this.settings.callback&&"function"==typeof this.settings.callback&&this.settings.callback(this.request.responseXML),this.initialize())}}.bind(this),this.request.open("GET",this.nextPageUrl),this.request.responseType="document",this.request.send()},Ajaxinate.prototype.removeClickListener=function(){this.nextPageLinkElement.removeEventListener("click",this.preventMultipleClicks)},Ajaxinate.prototype.removePaginationElement=function(){this.paginationElement.innerHTML="",this.destroy()},Ajaxinate.prototype.removeScrollListener=function(){document.removeEventListener("scroll",this.checkIfPaginationInView),window.removeEventListener("resize",this.checkIfPaginationInView),window.removeEventListener("orientationchange",this.checkIfPaginationInView)},Ajaxinate.prototype.destroy=function(){return{click:this.removeClickListener,scroll:this.removeScrollListener}[this.settings.method](),this},exports.default=Ajaxinate;